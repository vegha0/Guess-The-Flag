<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8"/>
        <title>Guess The Flag</title>
        <link rel="stylesheet" href="public/css/GuessTheFlag.css">
        <script src="https://www.gstatic.com/firebasejs/10.4.0/firebase-app-compact.js"></script>
        <script src="https://www.gstatic.com/firebasejs/10.4.0/firebase-auth-compact.js"></script>
        <script src="https://www.gstatic.com/firebasejs/10.4.0/firebase-database-compact.js"></script>
    </head>
    <body>
        <div class="container">
            <a class="bouton_normal" href="accueil.html">Continuer sans inscription</a>
        </div>
        <form id="signup-form">
            <h2>Inscription</h2>
            <input type="text" id="pseudo" placeholder="Pseudo" required/>
            <input type="email" id="email" placeholder="Email" required/>
            <div class="password-field-container"> 
                <input type="password" id="password" placeholder="Mot de passe" required/>
                <button type="button" id="toggle-password" aria-label="Afficher mot de passe" class="password-toggle">
                    <svg class="icon icon-show" viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" focusable="false">
                        <path fill="currentColor" d="M12 5c-7 0-11 6.5-11 7s4 7 11 7 11-6.5 11-7-4-7-11-7zm0 12a5 5 0 1 1 0-10 5 5 0 0 1 0 10zM12 9.5a2.5 2.5 0 1 0 .001 5.001A2.5 2.5 0 0 0 12 9.5z"/>
                    </svg>
                    <svg class="icon icon-hide" viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" focusable="false" style="display:none;">
                        <path fill="currentColor" d="M2 4.27L3.28 3 21 20.72 19.73 22 16.9 19.17A11.94 11.94 0 0 1 12 21c-7 0-11-6.5-11-7 0-.7.8-2.14 2.07-3.78L2 4.27zM12 7a5 5 0 0 1 4.9 4H14v2h2.54c-.28 1.02-.78 1.95-1.44 2.77L12 13.5A2.5 2.5 0 0 0 9.5 11H8a5 5 0 0 1 4-4z"/>
                    </svg>
                </button>
            </div>
            <button type="submit" id="signup-button">S'inscrire</button>
            <p>Déjà un compte? <a href="connexion.html">Connectez-vous ici</a></p>
            <p id="signup-message"></p>
        </form>
        <script>
            const firebaseConfig = {
                apiKey: "AIzaSyASZJsHUMB4RYXUIkJtutjeroQQIsJ4AvM",
                authDomain: "guess-the-flag-f8618.firebaseapp.com",
                databaseURL: "https://guess-the-flag-f8618-default-rtdb.europe-west1.firebasedatabase.app",
                projectId: "guess-the-flag-f8618",
                storageBucket: "guess-the-flag-f8618.appspot.com",
                messagingSenderId: "911762454696",
                appId: "1:911762454696:web:a4fb3085b4a56b0bb52a9d",
                measurementId: "G-5WDV5EK202"
            };
            firebase.initializeApp(firebaseConfig);
            const auth = firebase.auth();
            const database = firebase.database();

            const signupForm = document.getElementById("signup-form");
            const pseudoField = document.getElementById("pseudo");
            const emailField = document.getElementById("email");
            const passwordField = document.getElementById("password");
            const togglePasswordButton = document.getElementById("toggle-password");
            const signupMessage = document.getElementById("signup-message");

            togglePasswordButton.addEventListener("click", () => {
                const isPassword = passwordField.type === "password";
                passwordField.type = isPassword ? "text" : "password";

                const iconShow = document.querySelector(".icon-show");
                const iconHide = document.querySelector(".icon-hide");

                iconShow.style.display = isPassword ? "none" : "block";
                iconHide.style.display = isPassword ? "block" : "none";
            });

            signupForm.addEventListener("submit", function(event){
                event.preventDefault();

                const pseudo = document.getElementById("pseudo").value;
                const email = document.getElementById("email").value;
                const password = document.getElementById("password").value;

                if (!pseudo || !email || !password) {
                    signupMessage.style.color = "red";
                    signupMessage.textContent = "Veuillez remplir tous les champs.";
                    return;
                }

            auth.createUserWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    const user = userCredential.user;
                    // Sauvegarde du pseudo dans la base de données
                    return database.ref('users/' + user.uid).set({
                        pseudo: pseudo,
                        email: email,
                        highScoreQuiz: 0,
                        highScoreCLM: 0
                    });
                })
                .then(() => {
                    signupMessage.style.color = "green";
                    signupMessage.textContent = "Inscription réussie!";
                    setTimeout(() => {
                        window.location.href = "connexion.html";
                    }, 1000);
                })
                .catch((error) => {
                    signupMessage.style.color = "red";
                    signupMessage.textContent = "Erreur d'inscription: " + error.message;
                });
            });
        </script>
    </body>
</html>