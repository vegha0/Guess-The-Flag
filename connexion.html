<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <title>Guess The Flag</title>
        <link rel="stylesheet" href="public/css/GuessTheFlag.css">
        <script src="https://www.gstatic.com/firebasejs/10.4.0/firebase-app-compact.js"></script>
        <script src="https://www.gstatic.com/firebasejs/10.4.0/firebase-auth-compact.js"></script>
        <script src="https://www.gstatic.com/firebasejs/10.4.0/firebase-database-compact.js"></script>
    </head>
    <body>
        <div class="container">
            <a class="bouton_normal" href="accueil.html">Continuer sans connexion</a>
        </div>
        <form id="login-form">
            <h2>Connexion</h2>
            <input type="email" id="email" placeholder="Email" required/>
            <div class="password-field-container">
                <input type="password" id="password" placeholder="Mot de passe" required/>
                <button type="button" id="toggle-password" aria-label="Afficher mot de passe" class="password-toggle">
                    <svg class="icon icon-show" viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" focusable="false">
                        <path fill="currentColor" d="M12 5c-7 0-11 6.5-11 7s4 7 11 7 11-6.5 11-7-4-7-11-7zm0 12a5 5 0 1 1 0-10 5 5 0 0 1 0 10zM12 9.5a2.5 2.5 0 1 0 .001 5.001A2.5 2.5 0 0 0 12 9.5z"/>
                    </svg>
                    <svg class="icon icon-hide" viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" focusable="false" style="display:none;">
                        <path fill="currentColor" d="M2 4.27L3.28 3 21 20.72 19.73 22 16.9 19.17A11.94 11.94 0 0 1 12 21c-7 0-11-6.5-11-7 0-.7.8-2.14 2.07-3.78L2 4.27zM12 7a5 5 0 0 1 4.9 4H14v2h2.54c-.28 1.02-.78 1.95-1.44 2.77L12 13.5A2.5 2.5 0 0 0 9.5 11H8a5 5 0 0 1 4-4z"/>
                    </svg>
                </button>
            </div>
            <button type="submit" id="login-button">Se connecter</button>
            <p>Pas encore de compte? <a href="inscription.html">Inscrivez-vous ici</a></p>
            <p id="login-message"></p>
        </form>
        <script>
            const firebaseConfig = {
                apiKey: "AIzaSyASZJsHUMB4RYXUIkJtutjeroQQIsJ4AvM",
                authDomain: "guess-the-flag-f8618.firebaseapp.com",
                databaseURL: "https://guess-the-flag-f8618-default-rtdb.europe-west1.firebasedatabase.app",
                projectId: "guess-the-flag-f8618",
                storageBucket: "guess-the-flag-f8618.appspot.com",
                messagingSenderId: "911762454696",
                appId: "1:911762454696:web:a4fb3085b4a56b0bb52a9d",
                measurementId: "G-5WDV5EK202"
            };
            firebase.initializeApp(firebaseConfig);
            const auth = firebase.auth();

            const passwordField = document.getElementById("password");
            const toggleBtn = document.getElementById("toggle-password");
            const loginForm = document.getElementById("login-form");
            const loginMessage = document.getElementById("login-message");

            toggleBtn.addEventListener("click", () => {
                const isHidden = passwordField.type=== "password";
                passwordField.type = isHidden ? "text" : "password";
                toggleBtn.classList.toggle("active", isHidden);
                toggleBtn.setAttribute("aria-label", isHidden ? "Cacher mot de passe" : "Afficher mot de passe");
                passwordField.focus();
            });

            loginForm.addEventListener("submit", function(event){
                event.preventDefault();
                const email = document.getElementById("email").value;
                const password = passwordField.value;

                auth.signInWithEmailAndPassword(email, password)
                    .then((userCredential) => {
                        loginMessage.style.color = "green";
                        loginMessage.textContent = "Connexion rÃ©ussie!";
                        setTimeout(() => {
                            window.location.href = "accueil.html";
                        }, 1000);
                    })
                    .catch((error) => {
                        loginMessage.style.color = "red";
                        loginMessage.textContent = "Erreur de connexion: " + error.message;
                    });
            });
        </script>
    </body>
</html>